# Docker 이미지의 레이어 (Docker Image Layers)

### 확인 명령어 : docker history {image명}

## ✅ 레이어(Layer)란?

Docker 이미지에서 레이어는 **파일 시스템 변경 사항을 계층적으로 쌓은 것**입니다.  
이미지는 여러 개의 레이어로 구성되며, 각 레이어는 **불변(immutable)**하고 **캐시 가능(cacheable)**합니다.

---

## 📦 레이어의 구조

- Dockerfile의 **각 명령어(예: `RUN`, `COPY`, `ADD`)**는 새로운 레이어를 생성합니다.
- 레이어는 **읽기 전용(read-only)**이며, 컨테이너 실행 시 최상단에 **쓰기 가능한 writable layer**가 추가됩니다.


---

## 🧠 레이어의 특징

| 특징                 | 설명 |
|----------------------|------|
| **불변성**           | 한 번 생성된 레이어는 변경되지 않음 |
| **중복 제거**        | 같은 레이어는 여러 이미지에서 재사용 가능 |
| **캐싱 기능**        | 이전에 빌드한 레이어는 캐시로 재활용되어 속도 향상 |
| **용량 절약**        | 변경된 부분만 새로운 레이어로 저장되어 저장 공간 효율적 |

---

## 🔄 이미지 빌드 vs 컨테이너 실행

- **이미지 빌드 시**  
  → Dockerfile 명령어 순서대로 레이어가 쌓임  
  → 캐싱되어 동일한 명령어는 다시 실행되지 않음

- **컨테이너 실행 시**  
  → 이미지의 모든 레이어 + 쓰기 가능한 컨테이너 레이어  
  → 이 writable layer에서 파일을 생성/수정/삭제 가능

---

## 🎯 레이어 관리 팁

- `docker history <이미지명>`  
  → 이미지의 각 레이어 정보 확인

- 레이어 수 최소화 → Dockerfile 명령어를 최소한으로 합치기 (`&&` 연산 등)

- 자주 변경되는 부분을 **Dockerfile의 아래쪽에 위치**시키면 캐싱 활용 가능

---

## 📝 요약

| 개념         | 설명 |
|--------------|------|
| Layer         | Docker 이미지의 구성 단위, 각 명령마다 생성 |
| 불변성        | 생성된 후 변경되지 않음 |
| 재사용성      | 동일한 레이어는 여러 이미지가 공유 |
| 캐시 기능     | 빌드 속도 향상에 도움 |
| 최종 구조     | 읽기 전용 레이어 + 쓰기 가능한 컨테이너 레이어 |

---

## 🔗 참고 자료

- Docker 공식 문서: https://docs.docker.com/storage/storagedriver/
- 이미지 최적화 가이드: https://docs.docker.com/develop/develop-images/dockerfile_best-practices/
